Installazione

1) installare alcuni prerequisiti da root (pwd: alice)

    apt-get install git
    apt-get install apache2
    apt-get install openssl
    apt-get install vim
    apt-get install curl
    apt-get install mysql-server
    apt-get install mysql-client
    apt-get install libmysqlclient-dev
    apt-get install graphviz
    apt-get install libcurl4-openssl-dev
    apt-get install apache2-threaded-dev

2) creare l'utente dell'applicazione rails
    
    adduser alice
    (pwd: alice)

3) impostare i dati del proxy e importare il suo richiamo nei file iniziali di configurazione

    vim .my_set

export http_proxy=http://user:password@xxx.xxx.xxx.xxx:8080
export HTTP_PROXY=http://user:password@xxx.xxx.xxx.xxx:8080
export https_proxy=http://user:password@xxx.xxx.xxx.xxx:8080
export HTTPS_PROXY=http://user:password@xxx.xxx.xxx.xxx:8080
export ftp_proxy=http://user:password@xxx.xxx.xxx.xxx:8080
export FTP_PROXY=http://user:password@xxx.xxx.xxx.xxx:8080
export rsync_proxy=http://user:password@xxx.xxx.xxx.xxx:8080
export RSYNC_PROXY=http://user:password@xxx.xxx.xxx.xxx:8080
export all_proxy=http://user:password@xxx.xxx.xxx.xxx:8080
export ALL_PROXY=http://user:password@xxx.xxx.xxx.xxx:8080

    vim .bashrc 
         . ~/.my_set        
    vim .profile
         . ~/.my_set        
    vim .bash_profile 
         source ~/.profile

4) con user alice installare rbenv

git clone https://github.com/sstephenson/rbenv.git ~/.rbenv
git clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build

5) configurare il proprio profilo

echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.my_set
echo 'eval "$(rbenv init -)"' >> ~/.my_set

6) restart del terminale e installazione ruby 

verifica il comendo digitando
type rbenv
(deve essere riconosciuto come una funzione)

rbenv install -l 
(elenca tutte le versioni disponibili)

rbenv install 2.1.5
(installa una versione)
rbenv global 2.1.5
(imposta una versione globalmente)
rbenv local 2.1.5
(imposta una versione localmente)
rbenv rehash

7) restart del terminale e installazione di rails 
    gem install rails -v 4.1.7

8) Alice
    git clone https://github.com/pachiara/alice.git
    cd alice
    bundle install
    bundle exec rake db:setup RAILS_ENV=production
    bundle exec rake tmp:clear
    bundle exec rake assets:clean
    bundle exec rake assets:precompile RAILS_RELATIVE_URL_ROOT=/alice

9) Apache + Passenger

   gem install passenger
   passenger-install-apache2-module

   login con user root

   cd /var/www
   ln -s /home/alice/alice/public/ alice

   vim /etc/apache2/sites-enabled/000-default

....
LoadModule passenger_module /home/alice/.rbenv/versions/2.1.5/lib/ruby/gems/2.1.0/gems/passenger-4.0.53/buildout/apache2/mod_passenger.so
<IfModule mod_passenger.c>
 PassengerRoot /home/alice/.rbenv/versions/2.1.5/lib/ruby/gems/2.1.0/gems/passenger-4.0.53
 PassengerDefaultRuby /home/alice/.rbenv/versions/2.1.5/bin/ruby
</IfModule>

<VirtualHost *:80>
        ServerName  alice.lispa.it
        ServerAdmin chiara.palmieri@lispa.it

        DocumentRoot /var/www
        <Directory />
          Options FollowSymLinks
          AllowOverride None
        </Directory>
        <Directory /var/www/>
          Options Indexes FollowSymLinks MultiViews
          AllowOverride None
          # Uncomment this if you're on Apache >= 2.4:
           Require all granted
        </Directory>

################ Applicazioni Rails ####################
# in /var/www symbolic link to public dir in rails app #
########################################################

        RackBaseURI /alice
        <Directory /var/www/alice>
          # This relaxes Apache security settings.
          AllowOverride all
          # MultiViews must be turned off.
          Options -MultiViews
          # Uncomment this if you're on Apache >= 2.4:
          Require all granted
        </Directory>

        ErrorLog ${APACHE_LOG_DIR}/error.log

        # Possible values include: debug, info, notice, warn, error, crit,
        # alert, emerg.
        LogLevel warn

        CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>


10) impostare la secret_key per la produzione

cd /alice
RAILS_ENV=production rake secret

viene stampata a video la nuova key

sul server apache bisogna impostarla come variabile di environment
vim /etc/apache2/envvars

export SECRET_KEY_BASE=1418c46ca0e87bb9b28c40601ecc356513211a6d812eebec818fd594af338696c1869fcd0f460f5e51ecaf8460912f3615a5ab840542b710cd7c68b2b45fed68


11) riavviare apache2

    apache2ctl restart
